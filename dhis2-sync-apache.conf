<VirtualHost *:80>
    # Configuration du serveur
    ServerName localhost
    ServerAdmin admin@example.com

    # Logs Apache
    ErrorLog ${APACHE_LOG_DIR}/dhis2-sync-error.log
    CustomLog ${APACHE_LOG_DIR}/dhis2-sync-access.log combined

    # Niveau de log (warn, error, info, debug)
    LogLevel warn

    # Alias pour les fichiers statiques
    # Apache servira directement les fichiers statiques sans passer par Gunicorn
    Alias /static/ /home/gado/Integrate Health Dropbox/Djakpo GADO/projets/Dhis2/dhis_sync/staticfiles/
    Alias /media/ /home/gado/Integrate Health Dropbox/Djakpo GADO/projets/Dhis2/dhis_sync/media/

    # Permissions pour les fichiers statiques
    <Directory "/home/gado/Integrate Health Dropbox/Djakpo GADO/projets/Dhis2/dhis_sync/staticfiles">
        Require all granted
        Options -Indexes
        AllowOverride None
    </Directory>

    # Permissions pour les fichiers media
    <Directory "/home/gado/Integrate Health Dropbox/Djakpo GADO/projets/Dhis2/dhis_sync/media">
        Require all granted
        Options -Indexes
        AllowOverride None
    </Directory>

    # Configuration du proxy vers Gunicorn
    # Toutes les requêtes (sauf /static et /media) seront envoyées à Gunicorn
    ProxyPreserveHost On
    ProxyPass /static/ !
    ProxyPass /media/ !
    ProxyPass / http://127.0.0.1:8000/
    ProxyPassReverse / http://127.0.0.1:8000/

    # Headers pour le proxy
    RequestHeader set X-Forwarded-Proto "http"
    RequestHeader set X-Forwarded-Port "80"

    # Timeout pour les requêtes longues (synchronisation)
    ProxyTimeout 300

    # Configuration pour WebSocket (si nécessaire dans le futur)
    # RewriteEngine On
    # RewriteCond %{HTTP:Upgrade} =websocket [NC]
    # RewriteRule /(.*)           ws://127.0.0.1:8000/$1 [P,L]
    # RewriteCond %{HTTP:Upgrade} !=websocket [NC]
    # RewriteRule /(.*)           http://127.0.0.1:8000/$1 [P,L]
</VirtualHost>

# Configuration HTTPS (à activer après avoir obtenu un certificat SSL)
# <VirtualHost *:443>
#     ServerName your-domain.com
#     ServerAdmin admin@example.com
#
#     # SSL Configuration
#     SSLEngine on
#     SSLCertificateFile /etc/ssl/certs/your-cert.crt
#     SSLCertificateKeyFile /etc/ssl/private/your-key.key
#     SSLCertificateChainFile /etc/ssl/certs/your-chain.crt
#
#     # Logs
#     ErrorLog ${APACHE_LOG_DIR}/dhis2-sync-ssl-error.log
#     CustomLog ${APACHE_LOG_DIR}/dhis2-sync-ssl-access.log combined
#
#     # Static files
#     Alias /static/ /home/gado/Integrate Health Dropbox/Djakpo GADO/projets/Dhis2/dhis_sync/staticfiles/
#     Alias /media/ /home/gado/Integrate Health Dropbox/Djakpo GADO/projets/Dhis2/dhis_sync/media/
#
#     <Directory "/home/gado/Integrate Health Dropbox/Djakpo GADO/projets/Dhis2/dhis_sync/staticfiles">
#         Require all granted
#         Options -Indexes
#     </Directory>
#
#     <Directory "/home/gado/Integrate Health Dropbox/Djakpo GADO/projets/Dhis2/dhis_sync/media">
#         Require all granted
#         Options -Indexes
#     </Directory>
#
#     # Proxy to Gunicorn
#     ProxyPreserveHost On
#     ProxyPass /static/ !
#     ProxyPass /media/ !
#     ProxyPass / http://127.0.0.1:8000/
#     ProxyPassReverse / http://127.0.0.1:8000/
#
#     RequestHeader set X-Forwarded-Proto "https"
#     RequestHeader set X-Forwarded-Port "443"
#
#     ProxyTimeout 300
# </VirtualHost>
