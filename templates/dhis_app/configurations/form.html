{% extends 'layouts/base.html' %}
{% load static %}

{% block title %}{{ page_title }}{% endblock %}

{% block extra_head %}
<style>
    :root {
        --primary-color: #3b82f6;
        --secondary-color: #6b7280;
        --success-color: #10b981;
        --warning-color: #f59e0b;
        --danger-color: #ef4444;
        --light-bg: #f8fafc;
    }

    .form-section {
        background: linear-gradient(135deg, #ffffff 0%, #f8fafc 100%);
        border-radius: 1rem;
        padding: 2rem;
        margin-bottom: 2rem;
        box-shadow: 0 10px 25px -5px rgba(0, 0, 0, 0.1);
        border: 1px solid #e5e7eb;
        border-left: 4px solid var(--primary-color);
        transition: all 0.3s ease;
    }

    .form-section:hover {
        transform: translateY(-2px);
        box-shadow: 0 20px 40px -10px rgba(0, 0, 0, 0.15);
    }

    .form-section h3 {
        color: #1f2937;
        margin-bottom: 1.5rem;
        font-weight: 700;
        font-size: 1.25rem;
        display: flex;
        align-items: center;
        padding-bottom: 0.75rem;
        border-bottom: 2px solid #e5e7eb;
    }

    .form-section h3 .icon-wrapper {
        background: linear-gradient(135deg, var(--primary-color), #1d4ed8);
        border-radius: 50%;
        width: 2.5rem;
        height: 2.5rem;
        display: flex;
        align-items: center;
        justify-content: center;
        margin-right: 1rem;
        box-shadow: 0 4px 8px rgba(59, 130, 246, 0.3);
    }

    .form-section h3 i {
        color: white;
        font-size: 1rem;
    }

    .field-group {
        margin-bottom: 1.5rem;
    }

    .field-row {
        display: grid;
        grid-template-columns: 1fr;
        gap: 1.5rem;
    }

    @media (min-width: 768px) {
        .field-row {
            grid-template-columns: 1fr 1fr;
        }
    }

    /* Styles pour tous les champs de formulaire - Très spécifique */
    #config-form input,
    #config-form select,
    #config-form textarea,
    form input,
    form select,
    form textarea,
    .form-control,
    .form-select,
    input[type="text"],
    input[type="number"],
    input[type="date"],
    input[type="email"],
    input[type="url"] {
        width: 100% !important;
        padding: 0.875rem 1rem !important;
        border: 2px solid #e5e7eb !important;
        border-radius: 0.75rem !important;
        box-shadow: 0 1px 3px rgba(0, 0, 0, 0.1) !important;
        font-size: 0.875rem !important;
        transition: all 0.2s ease !important;
        background: white !important;
        font-family: inherit !important;
        margin: 0 !important;
        display: block !important;
    }

    #config-form input:focus,
    #config-form select:focus,
    #config-form textarea:focus,
    form input:focus,
    form select:focus,
    form textarea:focus,
    .form-control:focus,
    .form-select:focus,
    input:focus,
    select:focus,
    textarea:focus {
        outline: none !important;
        border-color: var(--primary-color) !important;
        box-shadow: 0 0 0 4px rgba(59, 130, 246, 0.1) !important;
        transform: translateY(-1px) !important;
    }

    .input-icon {
        position: relative;
    }

    .input-icon input,
    .input-icon select,
    .input-icon textarea,
    .input-icon .form-control,
    .input-icon .form-select {
        padding-left: 3rem !important;
    }

    .input-icon .icon {
        position: absolute;
        left: 1rem;
        top: 50%;
        transform: translateY(-50%);
        color: #9ca3af;
        font-size: 1rem;
        z-index: 10;
        pointer-events: none;
    }

    label {
        display: block;
        font-size: 0.875rem;
        font-weight: 600;
        color: #374151;
        margin-bottom: 0.5rem;
    }

    .required-field::after {
        content: ' *';
        color: var(--danger-color);
        font-weight: bold;
    }

    .form-help {
        font-size: 0.75rem;
        color: #6b7280;
        margin-top: 0.5rem;
        padding: 0.5rem;
        background: #f3f4f6;
        border-radius: 0.5rem;
        border-left: 3px solid #d1d5db;
    }

    .error-message {
        color: var(--danger-color);
        font-size: 0.75rem;
        font-weight: 600;
        margin-top: 0.5rem;
        padding: 0.5rem;
        background: #fef2f2;
        border: 1px solid #fecaca;
        border-radius: 0.5rem;
        display: flex;
        align-items: center;
    }

    .error-message i {
        margin-right: 0.5rem;
    }

    .btn {
        display: inline-flex;
        align-items: center;
        padding: 0.75rem 1.5rem;
        border: 2px solid transparent;
        border-radius: 0.75rem;
        font-size: 0.875rem;
        font-weight: 600;
        text-decoration: none;
        cursor: pointer;
        transition: all 0.2s ease;
        box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
    }

    .btn:hover {
        transform: translateY(-2px);
        box-shadow: 0 4px 8px rgba(0, 0, 0, 0.15);
    }

    .btn-primary {
        background: linear-gradient(135deg, var(--primary-color), #1d4ed8);
        color: white;
    }

    .btn-primary:hover {
        background: linear-gradient(135deg, #1d4ed8, #1e40af);
    }

    .btn-outline-secondary {
        color: var(--secondary-color);
        background: white;
        border-color: #d1d5db;
    }

    .btn-outline-secondary:hover {
        background: #f9fafb;
        border-color: var(--secondary-color);
    }

    .conditional-field {
        transition: all 0.3s ease;
    }

    .conditional-field.hidden {
        opacity: 0.3;
        pointer-events: none;
        transform: scale(0.98);
    }

    /* Styles pour les checkboxes */
    .form-check {
        display: flex;
        align-items: center;
        margin-bottom: 1rem;
    }

    #config-form input[type="checkbox"],
    .form-check-input,
    input[type="checkbox"] {
        width: 1.25rem !important;
        height: 1.25rem !important;
        margin-right: 0.75rem !important;
        border: 2px solid #d1d5db !important;
        border-radius: 0.375rem !important;
        background: white !important;
        transform: none !important;
        padding: 0 !important;
        display: inline-block !important;
    }

    #config-form input[type="checkbox"]:checked,
    .form-check-input:checked,
    input[type="checkbox"]:checked {
        background-color: var(--primary-color) !important;
        border-color: var(--primary-color) !important;
        transform: none !important;
    }

    #config-form input[type="checkbox"]:focus,
    .form-check-input:focus,
    input[type="checkbox"]:focus {
        transform: none !important;
        box-shadow: 0 0 0 2px rgba(59, 130, 246, 0.2) !important;
    }

    .form-check-label {
        font-size: 0.875rem;
        font-weight: 500;
        color: #374151;
        margin-bottom: 0;
    }

    .progress-indicator {
        display: flex;
        justify-content: center;
        margin-bottom: 2rem;
    }

    .progress-step {
        display: flex;
        align-items: center;
        margin: 0 1rem;
        color: #9ca3af;
        font-size: 0.875rem;
        font-weight: 500;
    }

    .progress-step.active {
        color: var(--primary-color);
    }

    .progress-step .step-number {
        width: 2rem;
        height: 2rem;
        border-radius: 50%;
        background: #e5e7eb;
        display: flex;
        align-items: center;
        justify-content: center;
        margin-right: 0.5rem;
        font-weight: 600;
        font-size: 0.75rem;
    }

    .progress-step.active .step-number {
        background: var(--primary-color);
        color: white;
    }
</style>
{% endblock %}

{% block content %}
<div class="min-h-screen bg-gradient-to-br from-blue-50 via-indigo-50 to-purple-50">
    <!-- En-tête moderne -->
    <div class="bg-white shadow-lg border-b border-gray-200">
        <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-8">
            <!-- Breadcrumb -->
            <nav class="flex mb-6" aria-label="Breadcrumb">
                <ol class="flex items-center space-x-3">
                    <li>
                        <a href="{% url 'sync_config_list' %}" class="text-blue-600 hover:text-blue-800 font-medium transition-colors duration-200 flex items-center">
                            <i class="fas fa-cogs mr-2"></i>
                            Configurations
                        </a>
                    </li>
                    <li>
                        <i class="fas fa-chevron-right text-gray-400"></i>
                    </li>
                    <li class="text-gray-600 font-medium">
                        {{ page_title }}
                    </li>
                </ol>
            </nav>

            <!-- En-tête principal -->
            <div class="flex items-center justify-between">
                <div>
                    <h1 class="text-5xl font-bold text-gray-900 mb-3">{{ page_title }}</h1>
                    <p class="text-xl text-gray-600">Configurez les paramètres de synchronisation entre vos instances DHIS2</p>
                </div>
                <div class="hidden lg:flex items-center space-x-4">
                    <div class="bg-gradient-to-r from-blue-500 to-indigo-600 rounded-2xl p-6 shadow-lg">
                        <i class="fas fa-plus text-white text-3xl"></i>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <div class="max-w-6xl mx-auto px-4 sm:px-6 lg:px-8 py-12">
        <!-- Indicateur de progression -->
        <div class="progress-indicator">
            <div class="progress-step active">
                <div class="step-number">1</div>
                <span>Informations</span>
            </div>
            <div class="progress-step">
                <div class="step-number">2</div>
                <span>Configuration</span>
            </div>
            <div class="progress-step">
                <div class="step-number">3</div>
                <span>Paramètres</span>
            </div>
        </div>

        <!-- Conteneur principal du formulaire -->
        <div class="bg-white shadow-2xl rounded-3xl overflow-hidden border border-gray-200">
            <!-- En-tête du formulaire -->
            <div class="bg-gradient-to-r from-blue-600 via-blue-700 to-indigo-800 px-8 py-8">
                <div class="flex items-center">
                    <div class="bg-white bg-opacity-20 rounded-full p-4 mr-4">
                        <i class="fas fa-cogs text-white text-2xl"></i>
                    </div>
                    <div>
                        <h2 class="text-3xl font-bold text-white">Configuration de Synchronisation</h2>
                        <p class="text-blue-100 mt-2 text-lg">Définissez les paramètres de votre synchronisation DHIS2</p>
                    </div>
                </div>
            </div>

            <!-- Formulaire -->
            <form method="post" id="config-form" novalidate class="p-8">
                {% csrf_token %}

                <!-- Section Informations Générales -->
                <div class="form-section">
                    <h3>
                        <div class="icon-wrapper">
                            <i class="fas fa-info-circle"></i>
                        </div>
                        Informations Générales
                    </h3>

                    <div class="field-group">
                        <label for="{{ form.name.id_for_label }}" class="required-field">
                            Nom de la Configuration
                        </label>
                        <div class="input-icon">
                            <i class="icon fas fa-tag"></i>
                            {{ form.name }}
                        </div>
                        {% if form.name.help_text %}
                            <div class="form-help">
                                <i class="fas fa-info-circle mr-1"></i>{{ form.name.help_text }}
                            </div>
                        {% endif %}
                        {% if form.name.errors %}
                            <div class="error-message">
                                <i class="fas fa-exclamation-triangle"></i>{{ form.name.errors.0 }}
                            </div>
                        {% endif %}
                    </div>

                    <div class="field-row">
                        <div class="field-group">
                            <label for="{{ form.source_instance.id_for_label }}" class="required-field">
                                Instance Source
                            </label>
                            <div class="input-icon">
                                <i class="icon fas fa-server" style="color: #10b981;"></i>
                                {{ form.source_instance }}
                            </div>
                            {% if form.source_instance.help_text %}
                                <div class="form-help" style="background: #f0fdf4; border-left-color: #10b981;">
                                    <i class="fas fa-info-circle mr-1"></i>{{ form.source_instance.help_text }}
                                </div>
                            {% endif %}
                            {% if form.source_instance.errors %}
                                <div class="error-message">
                                    <i class="fas fa-exclamation-triangle"></i>{{ form.source_instance.errors.0 }}
                                </div>
                            {% endif %}
                        </div>

                        <div class="field-group">
                            <label for="{{ form.destination_instance.id_for_label }}" class="required-field">
                                Instance Destination
                            </label>
                            <div class="input-icon">
                                <i class="icon fas fa-server" style="color: #3b82f6;"></i>
                                {{ form.destination_instance }}
                            </div>
                            {% if form.destination_instance.help_text %}
                                <div class="form-help" style="background: #eff6ff; border-left-color: #3b82f6;">
                                    <i class="fas fa-info-circle mr-1"></i>{{ form.destination_instance.help_text }}
                                </div>
                            {% endif %}
                            {% if form.destination_instance.errors %}
                                <div class="error-message">
                                    <i class="fas fa-exclamation-triangle"></i>{{ form.destination_instance.errors.0 }}
                                </div>
                            {% endif %}
                        </div>
                    </div>
                </div>

                <!-- Section Configuration de Synchronisation -->
                <div class="form-section">
                    <h3>
                        <div class="icon-wrapper">
                            <i class="fas fa-sync"></i>
                        </div>
                        Configuration de Synchronisation
                    </h3>

                    <div class="field-row">
                        <div class="field-group">
                            <label for="{{ form.sync_type.id_for_label }}" class="required-field">
                                Type de Synchronisation
                            </label>
                            <div class="input-icon">
                                <i class="icon fas fa-exchange-alt" style="color: #8b5cf6;"></i>
                                {{ form.sync_type }}
                            </div>
                            {% if form.sync_type.help_text %}
                                <div class="form-help" style="background: #faf5ff; border-left-color: #8b5cf6;">
                                    <i class="fas fa-info-circle mr-1"></i>{{ form.sync_type.help_text }}
                                </div>
                            {% endif %}
                            {% if form.sync_type.errors %}
                                <div class="error-message">
                                    <i class="fas fa-exclamation-triangle"></i>{{ form.sync_type.errors.0 }}
                                </div>
                            {% endif %}
                        </div>

                        <div class="field-group conditional-field" id="data-type-field">
                            <label for="{{ form.data_type.id_for_label }}">
                                Type de Données
                            </label>
                            <div class="input-icon">
                                <i class="icon fas fa-database" style="color: #f59e0b;"></i>
                                {{ form.data_type }}
                            </div>
                            {% if form.data_type.help_text %}
                                <div class="form-help" style="background: #fffbeb; border-left-color: #f59e0b;">
                                    <i class="fas fa-info-circle mr-1"></i>{{ form.data_type.help_text }}
                                </div>
                            {% endif %}
                            {% if form.data_type.errors %}
                                <div class="error-message">
                                    <i class="fas fa-exclamation-triangle"></i>{{ form.data_type.errors.0 }}
                                </div>
                            {% endif %}
                        </div>
                    </div>

                    <div class="field-row">
                        <div class="field-group">
                            <label for="{{ form.import_strategy.id_for_label }}">
                                Stratégie d'Import
                            </label>
                            <div class="input-icon">
                                <i class="icon fas fa-upload" style="color: #6366f1;"></i>
                                {{ form.import_strategy }}
                            </div>
                            {% if form.import_strategy.help_text %}
                                <div class="form-help">
                                    <i class="fas fa-info-circle mr-1"></i>{{ form.import_strategy.help_text }}
                                </div>
                            {% endif %}
                            {% if form.import_strategy.errors %}
                                <div class="error-message">
                                    <i class="fas fa-exclamation-triangle"></i>{{ form.import_strategy.errors.0 }}
                                </div>
                            {% endif %}
                        </div>

                        <div class="field-group">
                            <label for="{{ form.merge_mode.id_for_label }}">
                                Mode de Fusion
                            </label>
                            <div class="input-icon">
                                <i class="icon fas fa-code-branch" style="color: #ec4899;"></i>
                                {{ form.merge_mode }}
                            </div>
                            {% if form.merge_mode.help_text %}
                                <div class="form-help">
                                    <i class="fas fa-info-circle mr-1"></i>{{ form.merge_mode.help_text }}
                                </div>
                            {% endif %}
                            {% if form.merge_mode.errors %}
                                <div class="error-message">
                                    <i class="fas fa-exclamation-triangle"></i>{{ form.merge_mode.errors.0 }}
                                </div>
                            {% endif %}
                        </div>
                    </div>
                </div>

                <!-- Section Paramètres d'Exécution -->
                <div class="form-section">
                    <h3>
                        <div class="icon-wrapper">
                            <i class="fas fa-sliders-h"></i>
                        </div>
                        Paramètres d'Exécution
                    </h3>

                    <div class="field-row">
                        <div class="field-group">
                            <label for="{{ form.execution_mode.id_for_label }}">
                                Mode d'Exécution
                            </label>
                            <div class="input-icon">
                                <i class="icon fas fa-play-circle" style="color: #10b981;"></i>
                                {{ form.execution_mode }}
                            </div>
                            {% if form.execution_mode.help_text %}
                                <div class="form-help">
                                    <i class="fas fa-info-circle mr-1"></i>{{ form.execution_mode.help_text }}
                                </div>
                            {% endif %}
                            {% if form.execution_mode.errors %}
                                <div class="error-message">
                                    <i class="fas fa-exclamation-triangle"></i>{{ form.execution_mode.errors.0 }}
                                </div>
                            {% endif %}
                        </div>

                        <div class="field-group">
                            <label for="{{ form.max_page_size.id_for_label }}">
                                Taille de Page Maximale
                            </label>
                            <div class="input-icon">
                                <i class="icon fas fa-list-ol" style="color: #f59e0b;"></i>
                                {{ form.max_page_size }}
                            </div>
                            {% if form.max_page_size.help_text %}
                                <div class="form-help">
                                    <i class="fas fa-info-circle mr-1"></i>{{ form.max_page_size.help_text }}
                                </div>
                            {% endif %}
                            {% if form.max_page_size.errors %}
                                <div class="error-message">
                                    <i class="fas fa-exclamation-triangle"></i>{{ form.max_page_size.errors.0 }}
                                </div>
                            {% endif %}
                        </div>
                    </div>

                    <!-- Options et Cases à cocher -->
                    <div class="field-row">
                        <div class="field-group">
                            <div class="form-check">
                                {{ form.supports_paging }}
                                <label for="{{ form.supports_paging.id_for_label }}" class="form-check-label">
                                    Support de la Pagination
                                </label>
                            </div>
                            {% if form.supports_paging.help_text %}
                                <div class="form-help">
                                    <i class="fas fa-info-circle mr-1"></i>{{ form.supports_paging.help_text }}
                                </div>
                            {% endif %}
                        </div>

                        <div class="field-group">
                            <div class="form-check">
                                {{ form.is_active }}
                                <label for="{{ form.is_active.id_for_label }}" class="form-check-label">
                                    Configuration Active
                                </label>
                            </div>
                            {% if form.is_active.help_text %}
                                <div class="form-help">
                                    <i class="fas fa-info-circle mr-1"></i>{{ form.is_active.help_text }}
                                </div>
                            {% endif %}
                        </div>
                    </div>
                </div>

                <!-- Section Planification -->
                <div class="form-section">
                    <h3>
                        <div class="icon-wrapper">
                            <i class="fas fa-calendar-alt"></i>
                        </div>
                        Planification et Dates
                    </h3>

                    <div class="field-row">
                        <div class="field-group">
                            <div class="form-check">
                                {{ form.schedule_enabled }}
                                <label for="{{ form.schedule_enabled.id_for_label }}" class="form-check-label">
                                    Planification Activée
                                </label>
                            </div>
                            {% if form.schedule_enabled.help_text %}
                                <div class="form-help">
                                    <i class="fas fa-info-circle mr-1"></i>{{ form.schedule_enabled.help_text }}
                                </div>
                            {% endif %}
                        </div>

                        <div class="field-group conditional-field" id="schedule-interval-field">
                            <label for="{{ form.schedule_interval.id_for_label }}">
                                Intervalle de Planification (minutes)
                            </label>
                            <div class="input-icon">
                                <i class="icon fas fa-clock" style="color: #8b5cf6;"></i>
                                {{ form.schedule_interval }}
                            </div>
                            {% if form.schedule_interval.help_text %}
                                <div class="form-help">
                                    <i class="fas fa-info-circle mr-1"></i>{{ form.schedule_interval.help_text }}
                                </div>
                            {% endif %}
                        </div>
                    </div>

                    <div class="field-row">
                        <div class="field-group">
                            <label for="{{ form.sync_start_date.id_for_label }}">
                                Date de Début de Synchronisation
                            </label>
                            <div class="input-icon">
                                <i class="icon fas fa-calendar-plus" style="color: #10b981;"></i>
                                {{ form.sync_start_date }}
                            </div>
                            {% if form.sync_start_date.help_text %}
                                <div class="form-help">
                                    <i class="fas fa-info-circle mr-1"></i>{{ form.sync_start_date.help_text }}
                                </div>
                            {% endif %}
                        </div>

                        <div class="field-group">
                            <label for="{{ form.sync_end_date.id_for_label }}">
                                Date de Fin de Synchronisation
                            </label>
                            <div class="input-icon">
                                <i class="icon fas fa-calendar-minus" style="color: #ef4444;"></i>
                                {{ form.sync_end_date }}
                            </div>
                            {% if form.sync_end_date.help_text %}
                                <div class="form-help">
                                    <i class="fas fa-info-circle mr-1"></i>{{ form.sync_end_date.help_text }}
                                </div>
                            {% endif %}
                        </div>
                    </div>
                </div>

                <!-- Actions -->
                <div class="bg-gradient-to-r from-gray-50 to-gray-100 p-8 border-t border-gray-200 rounded-b-3xl -mx-8 -mb-8 mt-8">
                    <div class="flex flex-col sm:flex-row justify-between items-center space-y-4 sm:space-y-0">
                        <a href="{% url 'sync_config_list' %}" class="btn btn-outline-secondary hover:scale-105 transition-transform">
                            <i class="fas fa-arrow-left mr-2"></i>
                            Retour à la liste
                        </a>
                        <div class="flex space-x-4">
                            <button type="button" class="btn btn-outline-secondary hover:scale-105 transition-transform" onclick="resetForm()">
                                <i class="fas fa-undo mr-2"></i>
                                Réinitialiser
                            </button>
                            <button type="submit" class="btn btn-primary text-lg px-8 py-4 hover:scale-105 transition-transform shadow-xl">
                                <i class="fas fa-save mr-3"></i>
                                {{ submit_text|default:"Enregistrer la Configuration" }}
                            </button>
                        </div>
                    </div>
                </div>
            </form>
        </div>
    </div>
</div>
{% endblock %}

{% block extra_js %}
<script>
    document.addEventListener('DOMContentLoaded', function() {
        // Gestion de l'affichage conditionnel des champs
        const syncTypeField = document.getElementById('{{ form.sync_type.id_for_label }}');
        const dataTypeField = document.getElementById('data-type-field');
        const scheduleEnabledField = document.getElementById('{{ form.schedule_enabled.id_for_label }}');
        const scheduleIntervalField = document.getElementById('schedule-interval-field');

        function toggleDataTypeField() {
            if (syncTypeField) {
                const syncType = syncTypeField.value;
                const showDataType = ['data', 'events', 'tracker', 'both', 'all_data'].includes(syncType);

                if (dataTypeField) {
                    if (showDataType) {
                        dataTypeField.classList.remove('hidden');
                    } else {
                        dataTypeField.classList.add('hidden');
                    }
                }
            }
        }

        function toggleScheduleInterval() {
            if (scheduleEnabledField && scheduleIntervalField) {
                if (scheduleEnabledField.checked) {
                    scheduleIntervalField.classList.remove('hidden');
                } else {
                    scheduleIntervalField.classList.add('hidden');
                }
            }
        }

        if (syncTypeField) {
            syncTypeField.addEventListener('change', toggleDataTypeField);
            toggleDataTypeField(); // Initial check
        }

        if (scheduleEnabledField) {
            scheduleEnabledField.addEventListener('change', toggleScheduleInterval);
            toggleScheduleInterval(); // Initial check
        }

        // Animation d'entrée pour les sections
        const sections = document.querySelectorAll('.form-section');
        sections.forEach((section, index) => {
            section.style.opacity = '0';
            section.style.transform = 'translateY(20px)';
            setTimeout(() => {
                section.style.transition = 'all 0.6s ease';
                section.style.opacity = '1';
                section.style.transform = 'translateY(0)';
            }, index * 200);
        });

        // Mise à jour de l'indicateur de progression
        updateProgressIndicator();

        // Force l'application des styles aux champs de formulaire
        setTimeout(function() {
            const formElements = document.querySelectorAll('#config-form input, #config-form select, #config-form textarea');
            formElements.forEach(function(element) {
                element.style.cssText = `
                    width: 100% !important;
                    padding: 0.875rem 1rem !important;
                    border: 2px solid #e5e7eb !important;
                    border-radius: 0.75rem !important;
                    box-shadow: 0 1px 3px rgba(0, 0, 0, 0.1) !important;
                    font-size: 0.875rem !important;
                    transition: all 0.2s ease !important;
                    background: white !important;
                    font-family: inherit !important;
                    margin: 0 !important;
                    display: block !important;
                `;

                // Checkboxes get special treatment
                if (element.type === 'checkbox') {
                    element.style.cssText = `
                        width: 1.25rem !important;
                        height: 1.25rem !important;
                        margin-right: 0.75rem !important;
                        border: 2px solid #d1d5db !important;
                        border-radius: 0.375rem !important;
                        background: white !important;
                        transform: none !important;
                        padding: 0 !important;
                        display: inline-block !important;
                    `;
                }
            });

            // Apply padding-left for inputs with icons
            const iconInputs = document.querySelectorAll('.input-icon input, .input-icon select, .input-icon textarea');
            iconInputs.forEach(function(element) {
                element.style.paddingLeft = '3rem !important';
            });
        }, 100);
    });

    function resetForm() {
        if (confirm('Êtes-vous sûr de vouloir réinitialiser le formulaire ?')) {
            document.getElementById('config-form').reset();
            updateProgressIndicator();
        }
    }

    function updateProgressIndicator() {
        const form = document.getElementById('config-form');
        const steps = document.querySelectorAll('.progress-step');

        // Simple logic: mark steps as active based on filled required fields
        let activeStep = 1;

        // Check if basic info is filled
        if (form.elements['name'] && form.elements['name'].value) {
            activeStep = 2;
        }

        // Check if sync config is filled
        if (form.elements['sync_type'] && form.elements['sync_type'].value) {
            activeStep = 3;
        }

        steps.forEach((step, index) => {
            if (index < activeStep) {
                step.classList.add('active');
            } else {
                step.classList.remove('active');
            }
        });
    }

    // Update progress on form changes
    document.getElementById('config-form').addEventListener('input', updateProgressIndicator);
    document.getElementById('config-form').addEventListener('change', updateProgressIndicator);
</script>
{% endblock %}